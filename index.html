<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title> Free Fall Simulator</title>
    <style>
        /* --- 1. Modern Dark Styling --- */
        :root {
            --dark-bg: #1e1e1e;
            --dark-surface: #2d2d30;
            --primary-accent: #00bcd4; /* Cyan/Teal */
            --text-light: #f0f0f0;
            --text-muted: #9a9a9a;
            --ground-color: #4CAF50;
        }

        body {
            font-family: 'Consolas', 'Courier New', monospace;
            background-color: var(--dark-bg);
            color: var(--text-light);
            margin: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            height: 100vh;
            overflow: hidden;
        }

        /* Header/Controls */
        header {
            background: var(--dark-surface);
            width: 100%;
            padding: 1rem;
            box-shadow: 0 4px 12px rgba(0,0,0,0.4);
            display: flex;
            justify-content: center;
            gap: 25px;
            align-items: center;
            z-index: 10;
        }

        h1 { margin: 0; font-size: 1.4rem; color: var(--primary-accent); }

        .input-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        label { color: var(--text-muted); }

        input {
            padding: 8px;
            background-color: #3f3f42;
            color: var(--text-light);
            border: 1px solid #555;
            border-radius: 4px;
            width: 100px;
            font-size: 1rem;
            transition: border-color 0.2s;
        }

        input:focus { border-color: var(--primary-accent); outline: none; }

        button {
            padding: 8px 20px;
            background-color: var(--primary-accent);
            color: var(--dark-surface);
            font-weight: bold;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 1rem;
            transition: background 0.2s, transform 0.1s;
        }

        button:hover { background-color: #0097a7; }
        button:active { transform: scale(0.98); }
        
        button.reset { 
            background-color: #616161; 
            color: var(--text-light);
        }
        button.reset:hover { background-color: #424242; }

        /* Simulation Area */
        #sim-container {
            position: relative;
            flex-grow: 1;
            width: 100%;
            max-width: 800px;
            margin: 20px;
            /* Dark Sky / Atmosphere Gradient */
            background: linear-gradient(to bottom, #1f2f3f 0%, #3a4a5a 100%);
            border: 2px solid #555;
            border-bottom: 15px solid var(--ground-color);
            overflow: hidden;
            border-radius: 8px;
        }

        #ball {
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
            width: 40px;
            height: 40px;
            background: radial-gradient(circle at 30% 30%, #ffeb3b, #f57f17); /* Gold/Yellow */
            border-radius: 50%;
            box-shadow: 0 6px 10px rgba(0,0,0,0.5);
            top: 0;
            z-index: 5;
        }

        /* Data Dashboard */
        #dashboard {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(45, 45, 48, 0.95);
            border: 1px solid #444;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.3);
            min-width: 160px;
            z-index: 6;
        }

        .metric { margin-bottom: 12px; }
        .metric label {
            display: block; font-size: 0.8rem; color: var(--text-muted);
            text-transform: uppercase; letter-spacing: 1px;
        }
        .metric span {
            font-size: 1.6rem; font-weight: bold;
            color: var(--primary-accent);
        }
        
        /* Dynamic Ruler */
        .ruler-container {
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 80px;
            border-right: 1px solid rgba(255,255,255,0.1);
            background-color: rgba(0,0,0,0.2);
            z-index: 2;
        }
        
        .ruler-mark {
            position: absolute;
            right: 0;
            width: 15px;
            height: 1px;
            background: rgba(255,255,255,0.5);
        }
        
        .ruler-text {
            position: absolute;
            right: 25px;
            font-size: 12px;
            font-family: 'Consolas', monospace;
            transform: translateY(-50%);
            color: var(--text-light);
        }

    </style>
</head>
<body>

    <header>
        <h1>⚛️ Free Fall Lab</h1>
        <div class="input-group">
            <label for="heightInput">HEIGHT (m):</label>
            <input type="number" id="heightInput" value="100" min="1" step="1" oninput="updateRulerOnly()">
        </div>
        <button onclick="startSimulation()">DROP BALL</button>
        <button class="reset" onclick="resetSimulation()">RESET</button>
    </header>

    <div id="sim-container">
        <div id="ruler" class="ruler-container"></div>
        
        <div id="ball"></div>

        <div id="dashboard">
            <div class="metric">
                <label>Time Elapsed</label>
                <span id="disp-time">0.00 s</span>
            </div>
            <div class="metric">
                <label>Velocity</label>
                <span id="disp-velocity">0.0 m/s</span>
            </div>
            <div class="metric">
                <label>Height Left</label>
                <span id="disp-height">0.0 m</span>
            </div>
        </div>
    </div>

    <script>
        // Physics Constants
        const g = 9.81; // m/s^2

        // State Variables
        let isRunning = false;
        let startTime = null;
        let animationFrameId = null;
        let totalHeight = 100;

        // DOM Elements
        const ball = document.getElementById('ball');
        const container = document.getElementById('sim-container');
        const heightInput = document.getElementById('heightInput');
        
        // Display Elements
        const dTime = document.getElementById('disp-time');
        const dVel = document.getElementById('disp-velocity');
        const dHeight = document.getElementById('disp-height');
        const ruler = document.getElementById('ruler');

        function updateRulerOnly() {
            // New function to update the ruler instantly without resetting the simulation state
            const newHeight = parseFloat(heightInput.value);
            if (newHeight > 0) {
                // Temporarily update totalHeight for scaling calculation only
                drawRuler(newHeight); 
                dHeight.innerText = newHeight.toFixed(1) + " m";
            }
        }

        function init() {
            // Get user input height
            totalHeight = parseFloat(heightInput.value) || 100;
            
            // Reset Displays
            dHeight.innerText = totalHeight.toFixed(1) + " m";
            dTime.innerText = "0.00 s";
            dVel.innerText = "0.0 m/s";
            
            // Reset Ball
            ball.style.top = '0px';

            // DRAW THE DYNAMIC RULER
            drawRuler(totalHeight);
        }

        function startSimulation() {
            if (isRunning) return;
            totalHeight = parseFloat(heightInput.value);
            if (totalHeight <= 0 || isNaN(totalHeight)) return alert("Height must be a valid number greater than 0.");

            // Redraw ruler to ensure accuracy before starting
            drawRuler(totalHeight);

            isRunning = true;
            startTime = performance.now();
            requestAnimationFrame(gameLoop);
        }

        function resetSimulation() {
            isRunning = false;
            cancelAnimationFrame(animationFrameId);
            init();
        }

        function gameLoop(currentTime) {
            let t = (currentTime - startTime) / 1000;

            // Physics Calculations
            let distanceFallen = 0.5 * g * Math.pow(t, 2);
            let velocity = g * t;
            let currentHeight = totalHeight - distanceFallen;

            // Ground collision and stopping the loop
            if (currentHeight <= 0) {
                currentHeight = 0;
                distanceFallen = totalHeight;
                // Calculate precise time/velocity at impact
                t = Math.sqrt((2 * totalHeight) / g);
                velocity = g * t;
                isRunning = false;
            }

            // Update Text Displays
            dTime.innerText = t.toFixed(2) + " s";
            dVel.innerText = velocity.toFixed(1) + " m/s";
            dHeight.innerText = currentHeight.toFixed(1) + " m";

            // Update Ball Position (Visual Scaling)
            const availableHeightPx = container.clientHeight - ball.clientHeight - parseFloat(getComputedStyle(container).borderBottomWidth);
            const pixelsPerMeter = availableHeightPx / totalHeight;

            const pixelTop = distanceFallen * pixelsPerMeter;
            ball.style.top = pixelTop + 'px';

            if (isRunning) {
                animationFrameId = requestAnimationFrame(gameLoop);
            }
        }

        // --- DYNAMIC RULER LOGIC ---
        function getOptimalStep(height) {
             if (height <= 20) return 1;
             if (height <= 50) return 5;
             if (height <= 100) return 10;
             if (height <= 500) return 50;
             if (height <= 2000) return 100;
             return 500;
        }

        function drawRuler(heightMeters) {
            ruler.innerHTML = ''; // Clear existing ruler
            
            // Subtract the height of the ground border (15px) for accurate scaling
            const groundBorderHeight = 15;
            const availableHeightPx = container.clientHeight - ball.clientHeight - groundBorderHeight;
            const pixelsPerMeter = availableHeightPx / heightMeters;
            
            // Ensure the height is a positive number
            if (heightMeters <= 0 || isNaN(heightMeters)) return;

            const step = getOptimalStep(heightMeters);

            // Loop from 0 (ground) up to the total height
            for (let h = 0; h <= heightMeters; h += step) {
                
                const mark = document.createElement('div');
                mark.className = 'ruler-mark';
                const label = document.createElement('div');
                label.className = 'ruler-text';
                
                // Set the label text
                label.innerText = h + 'm';

                // Calculate vertical position (pixels from TOP)
                // metersFromTop = TotalHeight - CurrentTickHeight
                const metersFromTop = heightMeters - h;
                let topPosPx = metersFromTop * pixelsPerMeter;

                // Adjust positioning:
                // 1. Center the ruler tick vertically relative to the ball's center
                topPosPx += (ball.clientHeight / 2);
                // 2. Adjust for the ground border height (so 0m is exactly at the top of the ground)
                topPosPx += groundBorderHeight; 

                // Apply styles
                mark.style.top = topPosPx + 'px';
                label.style.top = topPosPx + 'px';

                ruler.appendChild(mark);
                ruler.appendChild(label);
            }
        }

        // Initialize on load and re-initialize on window resize
        window.onload = init;
        window.onresize = () => drawRuler(parseFloat(heightInput.value));

    </script>
</body>
</html>
